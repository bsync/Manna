version: '2'
services:
  nginx:
    container_name: frontend
    build: nginx
    restart: unless-stopped
    depends_on: 
      - manna
      - joomla
    env_file:
      - ./nginx/nginx-certbot.env
    ports:
      - 80:80
      - 443:443
    volumes:
      - nginx_secrets:/etc/letsencrypt
  joomla:
    image: joomla
    restart: unless-stopped
    links:
      - joomladb:mysql
    depends_on: 
      - joomladb
    ports:
      - 8080:80
    environment:
      JOOMLA_DB_HOST: joomladb
      JOOMLA_DB_PASSWORD: example
  joomladb:
    image: mysql:5.6
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: example
  manna:
    container_name: manna
    build: .
    volumes:
       - ./:/app
       - ./static:/static
    ports:
      - "8000:8000"
    depends_on: 
      - mongodb
    env_file: secrets
  mongodb:
    container_name: mongo
    image: 'bitnami/mongodb:4.0'
    ports:
      - "27017:27017"
    volumes:
      - 'mongodb_data:/bitnami'
volumes:
  mongodb_data:
    driver: local
  nginx_secrets:
