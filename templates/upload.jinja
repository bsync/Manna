{% extends "base.jinja" %}
{% block scripts %} 
	{{ super() }}
   {{ InitDataTable("catalog") }}
	<script>
		var form = document.forms.namedItem("fileinfo");
		form.addEventListener('submit', function(ev) {
			var oOutput = document.querySelector("#togo"),
				 oData = new FormData(form);
			
			oData.append("MetaData", "Some meta data.");
	
			var oReq = new XMLHttpRequest();
			oReq.open("POST", $form.attr('action'), true);
			oReq.onload = function(oEvent) {
				if (oReq.status == 200) {
					oOutput.innerHTML = "Uploaded!"; } 
				else {
					oOutput.innerHTML = "Error " + oReq.status + " occurred trying to upload your file.<br \/>";
					 }
		   };
			
			oReq.send(oData);
			ev.preventDefault();
		}, false);
	</script>
{% endblock %}
{% block content %}
{% if series %}
<div id="togo">
</div>
<div>
	<form name="fileinfo" 
			method="POST" 
			enctype="multipart/form-data" 
			action="http://www.pleromabiblechurch.org.s3.amazonaws.com">
		<input type="input"  name="key" value="pleromabiblechurch.org/lessons/${filename}" /><br />
		<input type="hidden" name="acl" value="public-read" />
		<!--input type="hidden" name="success_action_redirect" value="http://sigv4examplebucket.s3.amazonaws.com/successful_upload.html" /-->
		Content-Type: 
		<input type="input"  name="Content-Type" value="image/jpeg" /><br />
		<input type="hidden" name="x-amz-meta-uuid" value="14365123651274" /> 
		<input type="hidden" name="x-amz-server-side-encryption" value="AES256" /> 
		<input type="hidden"   name="X-Amz-Credential" value="AKIAIOSFODNN7EXAMPLE/20151229/us-east-2/s3/aws4_request" />
		<input type="hidden"   name="X-Amz-Algorithm" value="AWS4-HMAC-SHA256" />
		<input type="hidden"   name="X-Amz-Date" value="20171229T000000Z" />

		Tags for File: 
		<input type="input"  name="x-amz-meta-tag" value="" /><br />
		<input type="hidden" name="Policy" value='<Base64-encoded policy string>' />
		<input type="hidden" name="X-Amz-Signature" value="<signature-value>" />
		File: 
		<input type="file"   name="file" /> <br />
		<!-- The elements after this will be ignored -->
		<input type="submit" name="submit" value="Upload to Amazon S3" />
	</form>
</div>
{% else %}
<h1>Choose a series for upload:</h1>
<h2>Series Catalog:</h2>
<table id="catalog">
	<thead><tr> <th>Series</th> <th>Lessons</th> </tr> </thead>
	{% for ser in catalog.series() %}
	<tr>
		 <td><a href="/upload/{{ ser }}">{{ ser }}</a></td>
		 <td> {{ ser|count }} </td>
	</tr>
	{% endfor %}
</table>
{% endif %}
{% endblock %}
